<!doctype html>
<html>
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-102564547-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-102564547-2');
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Writing Better Cloud Code with Parse Server Example</title>
    <link rel="apple-touch-icon" sizes="57x57" href="/img/favicon/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/favicon/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/favicon/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/img/favicon/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/img/favicon/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/img/favicon/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/img/favicon/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon-180x180.png">
    <meta name="apple-mobile-web-app-title" content="Parse">
    <link rel="icon" type="image/png" href="/img/favicon/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/img/favicon/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/img/favicon/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/img/favicon/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/img/favicon/favicon-32x32.png" sizes="32x32">
    <meta name="msapplication-TileColor" content="#5298fc">
    <meta name="msapplication-TileImage" content="/img/favicon/apple-touch-icon-144x144.png">
    <meta name="application-name" content="Parse">
    <meta name="theme-color" content="#5298fc">
    <!-- CSS -->
    <!-- build:css -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/default.min.css">
    <link href="/css/blog.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" rel="stylesheet" />
    <!-- endbuild -->
    <!--[if lte IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/classlist/2014.01.31/classList.min.js"></script>
    <![endif]-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.js"></script>
    <!--[if lt IE 8]>
    <link rel="stylesheet" type="text/css" href="/stylesheets/ie7.css" />
    <![endif]-->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/stylesheets/ie8.css" />
    <![endif]-->
    <!--[if lt IE 10]>
    <link rel="stylesheet" type="text/css" href="/stylesheets/ie89.css" />
    <![endif]-->
    <script>if(Function('/*@cc_on return document.documentMode===10@*/')()){document.documentElement.className+=' ie10';}</script>
    <meta name="csrf-param" content="authenticity_token">
    <meta name="csrf-token" content="KxDoKysxiXDIRV8VXwDYlQStDGzjbGZ24y6ZgQLYAsE=">
    <meta name="description" content="The best place to stay up-to-date with the latest Parse news and events.
">
    <meta name="keywords" content="backend, mobile, development, server, code">
    <meta property="fb:app_id" content="361736430535656">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Parse">
    <meta property="og:image" content="http://blog.parseplatform.org//assets/images/social.jpg">
    <meta property="og:description" content="The best place to stay up-to-date with the latest Parse news and events.
">
    <meta property="og:url" content="http://blog.parseplatform.org//learn/javascript/github/tutorial/2021/02/18/Writing-Better-Code-Cloud-Code-with-Parse-Server-Example.html">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body class="pure p_docs p_docs_index  user_logged_in">
<div class="site__wrapper">
    <div class="site__content">
        <div class="content__wrapper">
            <header class="site__header site__header--white">
    <div class="container">
        <a href="/" class="header-logo">
            <span class="hidden">Parse</span>
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            	 viewBox="0 0 152 60" style="enable-background:new 0 0 152 60;" xml:space="preserve">
            <g>
            	<path class="line one" d="M23.072,39.678c-0.011,3.348-2.395,4.615-4.909,4.615c-2.851,0-4.541-1.701-4.541-4.357
            		c0-2.964,2.031-4.667,5.35-4.725h13.611c6.428,0.079,10.137-5.391,10.137-9.953c0-4.598-3.485-9.598-9.622-9.842
            		c-6.083-0.242-9.99,5.281-9.99,11.167v3.863"/>
            	<path class="line two" d="M23.072,39.678c-0.011,3.348-2.395,4.615-4.909,4.615c-2.851,0-4.541-1.701-4.541-4.357
            		c0-2.964,2.031-4.667,5.35-4.725h13.611c6.428,0.079,10.137-5.391,10.137-9.953c0-4.598-3.485-9.598-9.622-9.842
            		c-6.083-0.242-9.99,5.281-9.99,11.167v3.863"/>
            	<path class="line three" d="M23.072,39.678c-0.011,3.348-2.395,4.615-4.909,4.615c-2.851,0-4.541-1.701-4.541-4.357
            		c0-2.964,2.031-4.667,5.35-4.725h13.611c6.428,0.079,10.137-5.391,10.137-9.953c0-4.598-3.485-9.598-9.622-9.842
            		c-6.083-0.242-9.99,5.281-9.99,11.167v3.863"/>
            	<path class="st1" d="M151.88,31.106c0-4.561-2.575-7.835-7.173-7.872c-5.665-0.037-9.197,4.12-9.197,10.484v0.11
            		c0,6.033,3.863,9.601,9.601,9.601c1.839,0,4.083-0.405,5.739-1.177v-3.568c-1.839,0.956-3.752,1.398-5.408,1.398
            		c-3.568,0-6.07-1.803-6.18-5.959h12.36C151.807,33.056,151.88,32.026,151.88,31.106z M148.312,31.07h-8.829
            		c0.625-3.053,2.354-4.745,4.966-4.745c2.575,0,3.863,1.729,3.863,4.561V31.07z"/>
            	<path class="st1" d="M125.725,34.712l0.405,0.147c2.869,1.03,3.531,1.655,3.531,2.906c0,1.471-0.993,2.428-3.458,2.428
            		c-1.986,0-4.12-0.662-6.364-1.692v3.752c1.803,0.699,4.12,1.177,6.364,1.177c4.819,0,7.21-2.428,7.21-5.812
            		c0-2.943-1.471-4.525-5.408-5.959l-0.405-0.147c-3.127-1.14-3.752-1.655-3.752-2.869c0-1.361,0.956-2.281,3.237-2.281
            		c1.839,0,3.642,0.589,5.408,1.435v-3.531c-1.582-0.625-3.348-1.03-5.26-1.03c-4.598,0-7.1,2.575-7.1,5.886
            		C120.134,31.695,121.679,33.24,125.725,34.712"/>
            	<path class="st1" d="M110.863,29.892c1.288-2.023,3.09-3.016,5.26-3.016c0.773,0,1.508,0.11,2.17,0.331v-3.384
            		c-0.625-0.258-1.361-0.405-2.134-0.405c-2.281,0-4.01,1.03-5.518,3.09l-0.258-2.869h-3.164v19.386h3.642V29.892z"/>
            	<path class="st1" d="M96.481,23.197c-2.281,0-4.672,0.699-6.474,1.692v3.605c2.023-1.251,4.378-2.023,6.254-2.023
            		c2.612,0,3.679,1.14,3.679,3.274v1.619c-5.334,0.147-8.461,1.03-10.116,2.685c-1.177,1.14-1.692,2.685-1.692,4.267
            		c0,3.274,2.354,5.15,5.702,5.15c2.244,0,4.378-0.92,6.327-2.796l0.221,2.354h3.164V30.003
            		C103.544,25.405,101.263,23.197,96.481,23.197z M99.938,37.728c-1.471,1.619-3.2,2.722-5.297,2.722
            		c-1.729,0-2.833-0.883-2.833-2.428c0-2.281,1.876-3.642,8.13-3.826V37.728z"/>
            	<path class="st1" d="M77.609,17.643h-8.571v25.383h3.826v-8.314h4.745c5.923,0,9.491-3.164,9.491-8.498V26.14
            		C87.1,20.806,83.532,17.643,77.609,17.643z M83.311,26.214c0,3.421-1.986,5.04-5.444,5.04h-5.003V21.101h5.04
            		c3.421,0,5.408,1.619,5.408,5.04V26.214z"/>
            	<path class="st1" d="M27.838,2.192C12.204,2.192-0.12,14.589-0.12,30.15c0,15.597,12.323,27.958,27.958,27.958
            		c15.634,0,27.958-12.36,27.958-27.958C55.795,14.589,43.472,2.192,27.838,2.192z M32.473,36.955H18.752
            		c-1.986,0-3.164,1.214-3.164,3.017c0,1.582,1.067,2.722,2.612,2.722c1.766,0,2.796-1.214,2.906-3.016h4.01
            		c-0.184,4.341-2.906,6.658-6.953,6.658c-3.789,0-6.585-2.575-6.585-6.401c0-3.973,2.98-6.769,7.394-6.769h13.611
            		c4.598,0,8.093-3.348,8.093-7.909c0-4.598-3.127-7.799-7.578-7.799c-4.414,0-7.946,3.237-7.946,9.123v3.863h-4.046v-3.863
            		c0-7.872,5.076-12.986,12.066-12.986c6.695,0,11.551,4.782,11.551,11.588C44.723,32.026,39.499,36.955,32.473,36.955z"/>
            </g>
            </svg>
        </a>
        <a class="header-hamburger" data-menu-trigger="toggle">
            <span class="header-hamburger__wrap">
                <span class="header-hamburger__line--top"></span>
                <span class="header-hamburger__line--middle"></span>
                <span class="header-hamburger__line--bottom"></span>
                <span class="header-hamburger__line--arrow-top"></span>
                <span class="header-hamburger__line--arrow-bottom"></span>
            </span>
        </a>
        <ul class="header-nav">
            <li><a href="http://docs.parseplatform.org">Docs</a></li>
            <li><a class="active" href="/">Blog</a></li>
        </ul>
	</div><!-- container -->
</header>

            

<aside class="hero hero--docs-landing">
    <div class="grid-container">
        <div class="col--9">
            <div class="hero--docs-landing__content">
                
                <div>
    <span class="author">Daniel Blyth -</span>
    <span class="date">
        February
        
        18th,
        
        2021
    </span>
</div>

                <h1 class="h1 h1--white">
                    Writing Better Cloud Code with Parse Server Example
                </h1>
            </div>
        </div>
    </div>
</aside><!-- .hero -->
<div class="container padding-top-40 padding-bottom-50" data-nav-waypoint>
    <article role="article" class="posts">
        
        <div>
    
    <a href="/blog/categories/learn" class="btn btn--dark--outline btn--xsmall category">Learn</a>
    
    <a href="/blog/categories/javascript" class="btn btn--dark--outline btn--xsmall category">JavaScript</a>
    
    <a href="/blog/categories/github" class="btn btn--dark--outline btn--xsmall category">GitHub</a>
    
    <a href="/blog/categories/tutorial" class="btn btn--dark--outline btn--xsmall category">Tutorial</a>
    
</div>

        <div class="padding-bottom-20 padding-top-20">
  
  
</div>
        <div class="padding-bottom-40 post"><p>Parse Server is a great, quick way to create an app backend without requiring years of knowledge and time.</p>

<p>There are a few additional steps you can do to ensure that your code is the best it can be, and be assured that your Parse Server always runs as smoothly as possible, even as your Cloud Code continues to grow.</p>

<!-- more -->

<p>Today, I’m going to introduce you to the newest features in the <a href="https://github.com/parse-community/parse-server-example">Parse Server Example</a> project, which will help you write better code, specifically linting, testing, and coverage.</p>

<h1 id="linting">Linting</h1>

<p>Having well written code can save you a lot of time in the long run. There is nothing worse than looking back at old code you’ve written and needing to spend hours to wrap your head around it.</p>

<p>There have been <em>many</em> improvements to JavaScript since the initial release of Parse Server. Here are a few of them:</p>

<h2 id="using-const-or-let-instead-of-var">Using const or let instead of var</h2>

<p>In previous versions of our Parse javascript docs, we had many examples of javascript with <code class="language-plaintext highlighter-rouge">var</code>.</p>

<p>Using <code class="language-plaintext highlighter-rouge">var</code> can result in variables becoming accidently overridden, causing unwanted bugs, such as:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Parse</span><span class="p">.</span><span class="nx">Cloud</span><span class="p">.</span><span class="nx">beforeSave</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">object</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Parse</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="dl">'</span><span class="s1">Object</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// accidently redefine 'object' variable</span>
    <span class="kd">var</span> <span class="nx">object</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">query</span><span class="p">.</span><span class="nx">first</span><span class="p">({</span><span class="na">useMasterKey</span><span class="p">:</span><span class="kc">true</span><span class="p">});</span>
    <span class="nx">user</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">,</span><span class="nx">object</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// you might expect object to be request.object here, but now it is the object from the query</span>
<span class="p">});</span>
</code></pre></div></div>
<p>As of ES6, we have evolved all our example code away from var.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Parse</span><span class="p">.</span><span class="nx">Cloud</span><span class="p">.</span><span class="nx">beforeSave</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">object</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Parse</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="dl">'</span><span class="s1">Object</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// if you accidently redefine 'object' variable, you will get a syntax error using const.</span>
    <span class="kd">const</span> <span class="nx">secondObject</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">query</span><span class="p">.</span><span class="nx">first</span><span class="p">({</span><span class="na">useMasterKey</span><span class="p">:</span><span class="kc">true</span><span class="p">});</span>
    <span class="nx">user</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">object</span><span class="dl">'</span><span class="p">,</span><span class="nx">secondObject</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// object will always be request.object</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="object-literal-shorthand-syntax">Object Literal Shorthand Syntax</h2>

<p>With ES6, you can declare variables much clearer using shorthand syntax.</p>

<p>ES5:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Parse.Cloud.beforeSave('test', function(request) {
  var object = request.object;
  var user = request.user;
  request.log.info(object, user);
});
</code></pre></div></div>

<p>ES6 shorthand syntax:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Parse.Cloud.beforeSave('test', ({object,user,log}) =&gt; {
  log.info(object, user);
});
</code></pre></div></div>

<h2 id="for-of-loops">For of loops</h2>

<p>With ES6, you can write loops using <code class="language-plaintext highlighter-rouge">for (const object of objects)</code> rather than <code class="language-plaintext highlighter-rouge">for (var i=0; i&lt;objects.length; i++)</code></p>

<h2 id="promiseall">Promise.all</h2>

<p>Unless your code requires series excecution (i.e one task after an other), you should try to leverage <code class="language-plaintext highlighter-rouge">Promise.all</code> in your Cloud Functions. This will allow your Cloud Code to resolve much faster.</p>

<p>Poorly Optimized:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Parse</span><span class="p">.</span><span class="nx">Cloud</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="dl">'</span><span class="s1">testFunction</span><span class="dl">'</span><span class="p">,</span> <span class="p">({</span><span class="nx">user</span><span class="p">,</span> <span class="na">params</span><span class="p">:{</span><span class="nx">name</span><span class="p">,</span> <span class="nx">type</span><span class="p">}})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">nameQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Parse</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="dl">'</span><span class="s1">Name</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">nameQuery</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">nameData</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">nameQuery</span><span class="p">.</span><span class="nx">first</span><span class="p">({</span><span class="na">useMasterKey</span><span class="p">:</span><span class="kc">true</span><span class="p">});</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">nameData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">Parse</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="mi">141</span><span class="p">,</span> <span class="dl">'</span><span class="s1">name does not exist</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">const</span> <span class="nx">typeQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Parse</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="dl">'</span><span class="s1">Type</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">typeQuery</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">,</span><span class="nx">type</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">typeData</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">typeQuery</span><span class="p">.</span><span class="nx">first</span><span class="p">({</span><span class="na">useMasterKey</span><span class="p">:</span><span class="kc">true</span><span class="p">});</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">typeData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">Parse</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="mi">141</span><span class="p">,</span> <span class="dl">'</span><span class="s1">type does not exist</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">user</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">,</span> <span class="nx">typeData</span><span class="p">);</span>
  <span class="nx">user</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span> <span class="nx">nameData</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span><span class="na">useMasterKey</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">Type and name are valid</span><span class="dl">'</span>
<span class="p">},{</span>
  <span class="na">requireUser</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
  <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">]</span>
<span class="p">});</span>
</code></pre></div></div>

<p>This code is poorly optimized as it resolves the query for <code class="language-plaintext highlighter-rouge">name</code>, and then the query for <code class="language-plaintext highlighter-rouge">type</code>. These should be resolved in parallel as they are not dependant on eachother.</p>

<p>Using Promise.all:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Parse</span><span class="p">.</span><span class="nx">Cloud</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="dl">'</span><span class="s1">testFunction</span><span class="dl">'</span><span class="p">,</span> <span class="p">({</span><span class="nx">user</span><span class="p">,</span> <span class="na">params</span><span class="p">:{</span><span class="nx">name</span><span class="p">,</span> <span class="nx">type</span><span class="p">}})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">nameQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Parse</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="dl">'</span><span class="s1">Name</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">nameQuery</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">typeQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Parse</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="dl">'</span><span class="s1">Type</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">typeQuery</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">,</span><span class="nx">type</span><span class="p">);</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">nameData</span><span class="p">,</span> <span class="nx">typeData</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">nameQuery</span><span class="p">.</span><span class="nx">first</span><span class="p">({</span><span class="na">useMasterKey</span><span class="p">:</span><span class="kc">true</span><span class="p">}),</span><span class="nx">typeQuery</span><span class="p">.</span><span class="nx">first</span><span class="p">({</span><span class="na">useMasterKey</span><span class="p">:</span><span class="kc">true</span><span class="p">})]);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">nameData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">Parse</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="mi">141</span><span class="p">,</span> <span class="dl">'</span><span class="s1">name does not exist</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">typeData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">Parse</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="mi">141</span><span class="p">,</span> <span class="dl">'</span><span class="s1">type does not exist</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">user</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">,</span> <span class="nx">type</span><span class="p">);</span>
  <span class="nx">user</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span><span class="na">useMasterKey</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">Type and name are valid</span><span class="dl">'</span>
<span class="p">},{</span>
  <span class="na">requireUser</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
  <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">]</span>
<span class="p">});</span>
</code></pre></div></div>

<p>These are only a few examples of how to write better Cloud Code. You can learn more about new ES6, ES7, ES8, and other ES release features <a href="https://www.w3schools.com/js/js_es6.asp">here</a>.</p>

<p>On the latest <a href="https://github.com/parse-community/parse-server-example">Parse Server Example</a> project, you can now run <code class="language-plaintext highlighter-rouge">npm run prettier</code> to style your code, followed by <code class="language-plaintext highlighter-rouge">npm run lint</code> , which will run over your Cloud Code and check for quality issues. You can also run <code class="language-plaintext highlighter-rouge">npm run lint-fix</code> to fix any easy errors, such as indentation.</p>

<h1 id="testing">Testing</h1>

<p>As your Parse Server project gets larger and more complex, it can be challenging to add new features without previous ones becoming affected.</p>

<p>Automated testing is a good way to be assured that your functions are running as expected.</p>

<p>On the latest <a href="https://github.com/parse-community/parse-server-example">Parse Server Example</a> project, you can add tests by creating <code class="language-plaintext highlighter-rouge">*.spec.js</code> files in <code class="language-plaintext highlighter-rouge">/spec</code>.</p>

<p>This will boot up a mock database, start a Parse Server based off your <code class="language-plaintext highlighter-rouge">index.js</code>. You don’t have to worry about tests impacting your production database.</p>

<p>We have written some example tests to show you how it works.</p>

<p>Now, run <code class="language-plaintext highlighter-rouge">npm run test</code> and <code class="language-plaintext highlighter-rouge">jasmine</code> (<a href="https://jasmine.github.io/">the testing framework</a>) will check to make sure the tests run as expected.</p>

<p>Some helpful tips:</p>
<ul>
  <li>If you create a test using <code class="language-plaintext highlighter-rouge">fit()</code> or <code class="language-plaintext highlighter-rouge">fdescribe()</code>, jasmine will focus on those tests only, and others will be ignored.</li>
  <li>You can specify a file to test by using <code class="language-plaintext highlighter-rouge">npm run test /spec/testFile.spec.js</code></li>
  <li>You won’t be able to access any live data through the tests. You’ll have to save mock data using <code class="language-plaintext highlighter-rouge">beforeAll()</code> if you want to test queries.</li>
</ul>

<h1 id="coverage">Coverage</h1>

<p>Now you’ve learnt testing, it’s important to make sure as much of your Cloud Functions are covered by tests, so you can be sure that they are all running as expected.</p>

<p>After you’ve written and tested a few tests, you can run <code class="language-plaintext highlighter-rouge">npm run coverage</code>. This will create a new folder <code class="language-plaintext highlighter-rouge">/coverage</code>. Navigate to <code class="language-plaintext highlighter-rouge">/coverage/lcov-report</code> and open <code class="language-plaintext highlighter-rouge">index.html</code>, and you’ll be able to visually see what bits of your code you need to write tests for, and which sections are covered. The more of your Cloud Code you cover, the more you can be assured that changes don’t have any unforeseen consequences.</p>

<h1 id="watching-cloud-code">Watching Cloud Code</h1>

<p>Traditionally, you have to restart your Parse Server whenever you make changes to Cloud Code. Now, you can type <code class="language-plaintext highlighter-rouge">npm run watch</code>, and your Parse Server will auto-restart when any affected files are changed.</p>

<h1 id="new-scripts">New Scripts</h1>

<ul>
  <li><code class="language-plaintext highlighter-rouge">npm run watch</code> will start your Parse Server and restart if you make any changes.</li>
  <li><code class="language-plaintext highlighter-rouge">npm run lint</code> will check the linting of your Cloud Code, tests and <code class="language-plaintext highlighter-rouge">index.js</code>, as defined in <code class="language-plaintext highlighter-rouge">.eslintrc.json</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">npm run lint-fix</code> will attempt to fix the linting of your Cloud Code, tests and <code class="language-plaintext highlighter-rouge">index.js</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">npm run prettier</code> will help improve the formatting and layout of your Cloud Code, tests and <code class="language-plaintext highlighter-rouge">index.js</code>, as defined in <code class="language-plaintext highlighter-rouge">.prettierrc</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">npm run test</code> will run any tests that are written in <code class="language-plaintext highlighter-rouge">/spec</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">npm run coverage</code> will run tests and check coverage. Output is available in the <code class="language-plaintext highlighter-rouge">/coverage</code> folder.</li>
</ul>

<h1 id="tying-this-all-together">Tying this all together</h1>

<p>Great, now you can be assured that your Parse Server’s Cloud Code is working as expected, and is clean as it can be.</p>

<p>If you want to go one step further, you can use <a href="https://github.com/features/actions">GitHub Actions</a> or another CI platform to check your codes’ linting and tests prior to commit.</p>

<p>You’ll have to create a clone the Parse Server example repo though - we recommend creating it privately so that your data is protected.</p>

<p>The script that GitHub uses to check your Parse Server is located at <code class="language-plaintext highlighter-rouge">.github/workflows/ci.yml</code>. You can also create other commands here, such as packaging up and deploying to your production server. Be sure to use GitHub secrets for any sensitive keys!</p>

<p>Thanks for reading, we hope this helps you build better Parse Servers!</p>
</div>
        <div class="copy-block margin-top-40 signature">
            <div>
                <span class="author">Daniel Blyth,</span> <span class="byline">Parse Contributor</span>
            </div>
            <div class="margin-top-20">
                
                <span class="margin-left-10 margin-right-10"><a href="https://github.com/dblythy">GitHub</a></span>
                
                
                
            </div>

            <!-- Twitter cards metadata -->
            <meta name="twitter:card" content="summary">
            <meta name="twitter:site" content="@ParsePlatform">

            

            
              <meta name="twitter:title" content="Writing Better Cloud Code with Parse Server Example">
            

            
              <meta name="twitter:url" content="http://blog.parseplatform.org/learn/javascript/github/tutorial/2021/02/18/Writing-Better-Code-Cloud-Code-with-Parse-Server-Example.html">
            

            
              <meta name="twitter:description" content="Parse Server is a great, quick way to create an app backend without requiring years of knowledge and time.

">
            

            <meta name="twitter:image" content="https://blog.parseplatform.org/img/favicon/apple-touch-icon-144x144.png">

            

            

            <a class="btn btn--outline btn--twitter" href="https://twitter.com/intent/tweet?hashtags=ParsePlatform&original_referer=http://blog.parseplatform.org/learn/javascript/github/tutorial/2021/02/18/Writing-Better-Code-Cloud-Code-with-Parse-Server-Example.html&ref_src=twsrc%5Etfw&text=Writing Better Cloud Code with Parse Server Example by Daniel Blyth&tw_p=tweetbutton&url=http://blog.parseplatform.org/learn/javascript/github/tutorial/2021/02/18/Writing-Better-Code-Cloud-Code-with-Parse-Server-Example.html&via=ParsePlatform">Tweet this post</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

        </div>
    </article>
</div>

        </div><!-- /.content__wrapper -->
    </div><!-- /.site__content -->
</div><!-- /.site__wrapper -->
</body>

<script>
    anchors.options = {
      placement: 'left'
    };
    anchors.add();
</script>
</html>
